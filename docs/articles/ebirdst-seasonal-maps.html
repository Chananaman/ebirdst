<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating Seasonal Abundance and Range Maps and Stats • ebirdst</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ebirdst</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ebirdst-intro-mapping.html">Intro Vignette</a>
</li>
<li>
  <a href="../articles/ebirdst-pipd.html">Advanced Vignette</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CornellLabofOrnithology/ebirdst">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Generating Seasonal Abundance and Range Maps and Stats</h1>
                        <h4 class="author">Tom Auer, Daniel Fink</h4>
            
            <h4 class="date">2018-12-12</h4>
          </div>

    
    
<div class="contents">
<div id="outline" class="section level1">
<h1 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h1>
<ol style="list-style-type: decimal">
<li>Introduction</li>
<li>Season Definition</li>
<li>Abundance Maps</li>
<li>Range Maps</li>
<li>Days of Occupation Statistic</li>
</ol>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h1>
<p>This vignette describes how to recreate the seasonal map products found on the <a href="https://ebird.org/science/status-and-trends">eBird Status and Trends pages</a>. First, the vignette will cover the background and details for acquiring the seasonal definitions used on those pages and then proceed with examples of averaging data seasonally, making abundance maps, aggregating and smoothing data for range maps, and, finally, provide an example of calculating the “Days of occupation” statistic.</p>
</div>
<div id="season-defintion" class="section level1">
<h1 class="hasAnchor">
<a href="#season-defintion" class="anchor"></a>2. Season Defintion</h1>
<p>Generally, the seasons defined for eBird Status and Trends products are done through expert review. For information on the details of defining seasons, please see the <a href="https://ebird.org/science/status-and-trends/faq#seasons">seasons section of the FAQ</a>. While it is certainly possible to define your own seasons when making seasonal abundance and range maps, if you want to recreate the products with the same seasons as the website, you’ll need to login to ebird.org and download the “Regional range and abundance as tabular data” (the “Download all stats (csv)” button) from the eBird Status and Trends <a href="https://ebird.org/science/status-and-trends/download-data">download page</a>. The rest of this vignette will use the seasons defined in that csv file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For this vignette, the csv file has been downloaded, unzipped, and placed</span>
<span class="co"># in the /tmp directory of the root path</span>
all_stats &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"~/tmp/all-stats-regional-2018.csv/regionSummaries-2018.csv"</span>)

<span class="co"># This file contains information for all 107 species, so the first step</span>
<span class="co"># is to subset to Yellow-bellied Sapsucker for the example_data.</span>
yebsap &lt;-<span class="st"> </span>all_stats[all_stats$species_code ==<span class="st"> "yebsap"</span>, ]

<span class="co"># The file replicates season names, start and end dates across the </span>
<span class="co"># different regions for which statistics are calculated, so we can</span>
<span class="co"># get just one unique set of seasons by subsetting this data.frame</span>
<span class="co"># further to just Michigan</span>
yebsap_mi &lt;-<span class="st"> </span>yebsap[yebsap$region_name ==<span class="st"> "Michigan"</span>, ]
<span class="kw">print</span>(yebsap_mi[, <span class="kw">c</span>(<span class="st">"season_name"</span>, <span class="st">"start_dt"</span>, <span class="st">"end_dt"</span>)])</code></pre></div>
<pre><code>##                  season_name   start_dt     end_dt
## 44117               breeding 2015-05-24 2015-09-07
## 44118            nonbreeding 2015-11-23 2015-03-15
## 44119 postbreeding_migration 2015-09-14 2015-11-16
## 44120  prebreeding_migration 2015-03-22 2015-05-17</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># cleanup unneeded data</span>
<span class="kw">rm</span>(all_stats, yebsap)</code></pre></div>
</div>
<div id="abundance-maps" class="section level1">
<h1 class="hasAnchor">
<a href="#abundance-maps" class="anchor"></a>3. Abundance Maps</h1>
<p>This section will give an example of how to average the weekly abundance data together and generate both individual and combined seasonal maps, in the style of the eBird Status and Trends Abundance <a href="https://ebird.org/science/status-and-trends/yebsap/abundance-map">maps</a>, using the example_data available, which has been subset to the state of Michigan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># DOWNLOAD DATA</span>
<span class="co"># Currently, example data is available on a public s3 bucket. The following </span>
<span class="co"># download_data() function copies the species results to a selected path and </span>
<span class="co"># returns the full path of the results. Please note that the example_data is</span>
<span class="co"># for Yellow-bellied Sapsucker and has the same run code as the real data,</span>
<span class="co"># so if you download both, make sure you put the example_data somewhere else.</span>
sp_path &lt;-<span class="st"> </span><span class="kw"><a href="../reference/download_data.html">download_data</a></span>(<span class="dt">species =</span> <span class="st">"example_data"</span>, <span class="dt">path =</span> <span class="st">"~/tmp/"</span>)

<span class="co"># load trimmed mean abundances and label dates</span>
abunds &lt;-<span class="st"> </span>raster::<span class="kw">stack</span>(<span class="kw">list.files</span>(<span class="dt">path =</span> <span class="kw">paste0</span>(sp_path, <span class="st">"/results/tifs/"</span>),
                                   <span class="dt">pattern =</span> <span class="st">"*_hr_2016_abundance_umean.tif"</span>,
                                   <span class="dt">full.names =</span> <span class="ot">TRUE</span>))
abunds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/label_raster_stack.html">label_raster_stack</a></span>(abunds)

<span class="co"># getting the data vector will make interacting with the seasonal definitions easier</span>
date_vector &lt;-<span class="st"> </span><span class="kw"><a href="../reference/parse_raster_dates.html">parse_raster_dates</a></span>(abunds)

<span class="co"># average by season</span></code></pre></div>
</div>
<div id="range-maps" class="section level1">
<h1 class="hasAnchor">
<a href="#range-maps" class="anchor"></a>4. Range Maps</h1>
</div>
<div id="day-use-statistic" class="section level1">
<h1 class="hasAnchor">
<a href="#day-use-statistic" class="anchor"></a>5. Day Use Statistic</h1>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#outline">Outline</a></li>
      <li><a href="#introduction">1. Introduction</a></li>
      <li><a href="#season-defintion">2. Season Defintion</a></li>
      <li><a href="#abundance-maps">3. Abundance Maps</a></li>
      <li><a href="#range-maps">4. Range Maps</a></li>
      <li><a href="#day-use-statistic">5. Day Use Statistic</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://twitter.com/tom_auer">Tom Auer</a>, Daniel Fink, <a href="http://strimas.com">Matthew Strimas-Mackey</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
